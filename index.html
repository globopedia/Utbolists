<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Futbolistas ‚Äî Hurac√°n</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=MuseoModerno:wght@500&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'MuseoModerno', arial-black; background:#fff; color:#222; margin:20px; }
    h1 { color:#FF0000; text-align:center; }
    .logo { display:block; margin:0 auto 10px; width:100px; }
    select { padding:8px; border-radius:8px; border:2px solid #FF0000; font-size:16px; margin-bottom:20px; }
    .club-card { border:3px solid #FF0000; border-radius:20px; padding:20px; max-width:900px; margin:0 auto; background:#fff; box-shadow:0 4px 12px rgba(0,0,0,.1); }
    .club-header { display:flex; align-items:center; gap:15px; border-bottom:2px solid #FF0000; padding-bottom:10px; margin-bottom:10px; }
    h2 { margin:0; color:#FF0000; font-size:22px; }
    .stats { margin-top:20px; }
    .stat-group { margin-bottom:20px; padding:12px; border:1px solid #FF0000; border-radius:12px; background:#fff5f5; }
    .stat-title { font-weight:bold; color:#FF0000; margin-bottom:6px; }
    .hr { border:none; border-top:1px solid #FF0000; margin:8px 0; }
    .partido-card { border:1px solid #ccc; border-radius:6px; padding:6px; margin:4px 0; background:#fafafa; font-size:14px; text-align: center; }
    .acordeon { border: 1px solid #ddd; border-radius: 6px; margin: 6px 0; background: #fefefe; }
    .acordeon-header { background: #eee; padding: 4px 8px; cursor: pointer; font-size: 14px; text-align: right; position: relative; padding-right: 20px; }
    .acordeon-header::after { content: "‚ñæ"; position: absolute; right: 0; transition: transform 0.3s; }
    .acordeon-header.abierto::after { transform: rotate(180deg); }
    .acordeon-body { max-height: 1000px; overflow: hidden; transition: max-height 0.3s ease; padding: 8px; }
    .acordeon-body.cerrado { max-height: 0; padding: 0 8px; }
    .resultado1-box, .resultado2-box {
      display: inline-block; width: 16px; height: 28px; font-size: 32px; font-weight: bold;
      line-height: 28px; text-align: center; margin: 2px; padding: 10px 10px;
      border: 3px solid #FF0000; border-radius: 6px; background: #fff5f5;
      vertical-align: middle; min-width: 26px;
    }
    .escudo-huracan, .escudo-rival { width: 50px; height: 50px; object-fit: contain; position: relative; top: 6px; vertical-align: middle; }
    .resultado-con-escudo { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; justify-content:center; }
    .stat-title small { color:#666; font-weight:normal; margin-left:6px; }

  .bandera {
  height: 30px;
  margin: 6px;
  border-radius: 5px;
  box-shadow: 0 0 2px rgba(0,0,0,0.3);
  vertical-align: middle;
}
#autocompleteList li:hover {
  background-color: #ffdddd;
  border-radius: 6px;
  box-shadow: 0 0 4px rgba(255, 0, 0, 0.2);
  transition: all 0.2s;
}    
  </style>
</head>
<body>
  <img src="https://globopedia.github.io/Artids/logo_globopedia.png" alt="Logo Hurac√°n" class="logo" />
  <h1>üìú Futbolistas</h1>

<div style="text-align:center; position:relative;">
  <label for="futbolistaSearch">Busc√° futbolista: </label>
  <input type="text" id="futbolistaSearch" placeholder="Escrib√≠ un nombre..." autocomplete="off" style="padding:8px;border-radius:8px;border:2px solid #FF0000;font-size:16px;margin-bottom:20px;"><select id="futbolistaSelect" style="display:none;"></select>
  <ul id="autocompleteList" style="position:absolute;left:50%;transform:translateX(-50%);background:white;border:1px solid #ccc;border-radius:8px;width:300px;max-height:200px;overflow:auto;list-style:none;padding:0;margin-top:2px;z-index:1000;"></ul>
</div>

  <div id="futbolistaInfo" class="club-card" style="display:none;"></div>

  <script>
    const futbolistasURL = "https://globopedia.github.io/Utbolists/Utbolists.csv?v=" + Date.now();
    const partidosURL = "https://globopedia.github.io/Artids/Artids2000.csv?v=" + Date.now();
    const partidosURL2 = "https://globopedia.github.io/Artids/Encuentros_Huracan.csv?v=" + Date.now();

    let futbolistas = [];
    let encuentros = [];

    const norm = (t) => (t || "").toString().normalize("NFD").replace(/[\u0300-\u036f]/g, "").trim().toLowerCase();
    const cap = (s) => s ? s.charAt(0).toUpperCase() + s.slice(1).toLowerCase() : s;

    const ORDEN_COMPETENCIAS = ["Apertura BN 2006/07","Clausura BN 2006/07","2¬∞ Puesto BN 2006/07","Promoci√≥n 2007","Gira por M√©xico 2007","Apertura 2007/08","Clausura 2007/08","Copa Cafam 2008","Apertura 2008/09","Clausura 2008/09","Apertura 2009/10","Clausura 2009/10","Despedida de Marcelinho Carioca 2010","Apertura 2010/11",
"Clausura 2010/11","Desempate Descenso 2011","Campeonato B Nacional 2011/12","Copa Argentina 2012","Copa de Cl√°sicos 2012",
"Campeonato B Nacional 2012/13","Copa Argentina 2013","Campeonato B Nacional 2013/14","Desempate 3¬∞ Puesto BN 2013/14","Copa Argentina 2014",
"Desempate 3¬∞ Puesto NB 2013/14","Campeonato B Nacional 2014","Desempate 5¬∞ Puesto NB 2014",
"Copa Libertadores 2015","Campeonato 2015","Supercopa 2015","Copa Argentina 2015","Copa Sudamericana 2015","Copa Ciudad de Buenos Aires 2016",
"Copa Libertadores 2016","Campeonato 2016","Copa Argentina 2016","Campeonato 2016/17","Copa Sudamericana 2017",
"Copa Argentina 2017","Superliga 2017/18","Copa Schneider 2018","Copa Argentina 2018","Superliga 2018/19","Copa Libertadores 2019",
"Copa Superliga 2019","Copa Argentina 2019","Superliga 2019/20","Copa Sudamericana 2020","Copa Superliga 2020",
"Copa Maradona 2020","Copa-LPF 2021","Copa Argentina 2020","Torneo-LPF 2021","Amistosos 2022","Copa-LPF 2022",
"Copa Argentina 2022","Torneo-LPF 2022","Torneo-LPF 2023","Copa Argentina 2023","Copa Libertadores 2023",
"Copa Sudamericana 2023","Copa-LPF 2023","Copa Agust√≠n Pe√±a 2024","Serie R√≠o de la Plata 2024","Copa-LPF 2024","Copa Argentina 2024","Torneo-LPF 2024",
"Serie R√≠o de la Plata 2025","Apertura-LPF 2025","Copa Argentina 2025","Copa Sudamericana 2025","Clausura-LPF 2025","Otros"];
    const CONDICIONES = ["Local","Neutral","Visitante"];
    const SITUACIONES = ["Victoria","Empate","Derrota"];

    function bucketCompetencia(torneo) {
      const t = norm(torneo || "");
      if (t.includes("apertura nacional b 2006")) return "Apertura BN 2006/07";
      if (t.includes("clausura nacional b 2007")) return "Clausura BN 2006/07";
      if (t.includes("2¬∞ puesto nacional b 2007")) return "2¬∞ Puesto BN 2006/07";
      if (t.includes("promocion 2007")) return "Promoci√≥n 2007";
      if (t.includes("mexico 2007")) return "Gira por M√©xico 2007";
      if (t.includes("apertura 2007")) return "Apertura 2007/08";
      if (t.includes("clausura 2008")) return "Clausura 2007/08";
      if (t.includes("cafam 2008")) return "Copa Cafam 2008";
      if (t.includes("apertura 2008")) return "Apertura 2008/09";
      if (t.includes("clausura 2009")) return "Clausura 2008/09";
      if (t.includes("apertura 2009")) return "Apertura 2009/10";
      if (t.includes("carioca 2010")) return "Despedida de Marcelinho Carioca 2010";
      if (t.includes("clausura 2010")) return "Clausura 2009/10";
      if (t.includes("apertura 2010")) return "Apertura 2010/11";
      if (t.includes("clausura 2011")) return "Clausura 2010/11";
      if (t.includes("campeonato 10-11")) return "Desempate Descenso 2011";
      if (t.includes("nacional b 11-12")) return "Campeonato B Nacional 2011/12";
      if (t.includes("copa argentina 2012")) return "Copa Argentina 2012";
      if (t.includes("clasicos 2012")) return "Copa de Cl√°sicos 2012";
      if (t.includes("nacional b 12-13")) return "Campeonato B Nacional 2012/13";
      if (t.includes("copa argentina 2013")) return "Copa Argentina 2013";
      if (t.includes("nacional b 13-14")) return "Campeonato B Nacional 2013/14";
      if (t.includes("copa argentina 2014")) return "Copa Argentina 2014";
      if (t.includes("nb 13-14")) return "Desempate 3¬∞ Puesto BN 2013/14";
      if (t.includes("nacional b 2014")) return "Campeonato B Nacional 2014";
      if (t.includes("nb 2014")) return "Desempate 5¬∞ Puesto NB 2014";
      if (t.includes("libertadores 2015")) return "Copa Libertadores 2015";
      if (t.includes("campeonato 2015")) return "Campeonato 2015";
      if (t.includes("supercopa 2015")) return "Supercopa 2015";
      if (t.includes("copa argentina 2015")) return "Copa Argentina 2015";
      if (t.includes("sudamericana 2015")) return "Copa Sudamericana 2015";
      if (t.includes("buenos aires 2016")) return "Copa Ciudad de Buenos Aires 2016";
      if (t.includes("libertadores 2016")) return "Copa Libertadores 2016";
      if (t.includes("campeonato 2016")) return "Campeonato 2016";
      if (t.includes("copa argentina 2016")) return "Copa Argentina 2016";
      if (t.includes("campeonato 16-17")) return "Campeonato 2016/17";
      if (t.includes("sudamericana 2017")) return "Copa Sudamericana 2017";
      if (t.includes("copa argentina 2017")) return "Copa Argentina 2017";
      if (t.includes("saf 17-18")) return "Superliga 2017/18";
      if (t.includes("schneider 2018")) return "Copa Schneider 2018";
      if (t.includes("copa argentina 2018")) return "Copa Argentina 2018";
      if (t.includes("saf 18-19")) return "Superliga 2018/19";
      if (t.includes("libertadores 2019")) return "Copa Libertadores 2019";
      if (t.includes("superliga 2019")) return "Copa Superliga 2019";
      if (t.includes("copa argentina 2019")) return "Copa Argentina 2019";
      if (t.includes("saf 19-20")) return "Superliga 2019/20";
      if (t.includes("san juan 2020")) return "Copa San Juan 2020";
      if (t.includes("sudamericana 2020")) return "Copa Sudamericana 2020";
      if (t.includes("superliga 2020")) return "Copa Superliga 2020";
      if (t.includes("copa maradona 2020")) return "Copa Maradona 2020";
      if (t.includes("copa-lpf 2021")) return "Copa-LPF 2021";
      if (t.includes("copa argentina 2020")) return "Copa Argentina 2020";
      if (t.includes("torneo-lpf 2021")) return "Torneo-LPF 2021";
      if (t.includes("amistosos 2022")) return "Amistosos 2022";
      if (t.includes("copa-lpf 2022")) return "Copa-LPF 2022";
      if (t.includes("copa argentina 2022")) return "Copa Argentina 2022";
      if (t.includes("torneo-lpf 2022")) return "Torneo-LPF 2022";
      if (t.includes("torneo-lpf 2023")) return "Torneo-LPF 2023";
      if (t.includes("copa argentina 2023")) return "Copa Argentina 2023";
      if (t.includes("libertadores 2023")) return "Copa Libertadores 2023";
      if (t.includes("sudamericana 2023")) return "Copa Sudamericana 2023";
      if (t.includes("copa-lpf 2023")) return "Copa-LPF 2023";
      if (t.includes("pe√±a 2024")) return "Copa Agust√≠n Pe√±a 2024";
      if (t.includes("plata 2024")) return "Serie R√≠o de la Plata 2024";
      if (t.includes("copa-lpf 2024")) return "Copa-LPF 2024";
      if (t.includes("copa argentina 2024")) return "Copa Argentina 2024";
      if (t.includes("torneo-lpf 2024")) return "Torneo-LPF 2024";
      if (t.includes("plata 2025")) return "Serie R√≠o de la Plata 2025";
      if (t.includes("apertura-lpf 2025")) return "Apertura-LPF 2025";
      if (t.includes("copa argentina 2025")) return "Copa Argentina 2025";
      if (t.includes("sudamericana 2025")) return "Copa Sudamericana 2025";
      if (t.includes("clausura-lpf 2025")) return "Clausura-LPF 2025";
      return "Otros";
    }

Promise.all([
  fetch(futbolistasURL).then(r => { if(!r.ok) throw new Error("Futbolistas CSV no disponible"); return r.text(); }),
  fetch(partidosURL).then(r => { if(!r.ok) throw new Error("Partidos CSV 1 no disponible"); return r.text(); }),
  fetch(partidosURL2).then(r => { if(!r.ok) throw new Error("Partidos CSV 2 no disponible"); return r.text(); })
])
.then(([csvFutbolistas, csvPartidos1, csvPartidos2]) => {
      
    futbolistas = Papa.parse(csvFutbolistas, { header: true, skipEmptyLines: true }).data.map(c => ({
        id: (c.ID ?? "").toString().trim(),
        futbolista: (c["Futbolista"] ?? "").toString().trim(),
        nombre: (c.Nombre ?? "").toString().trim(),
        posicion: (c.Posici√≥n ?? "").toString().trim(),
        fechanac: (c.FechaNac?? "").toString().trim(),
        lugarnac: (c.LugarNac?? "").toString().trim(),
        pais: (c.Pa√≠s ?? c.Pais ?? "").toString().trim(),
        fechamuerte: (c.FechaMuerte ?? "").toString().trim(),
        lugarmuerte: (c.LugarMuerte ?? "").toString().trim(),
        peso: (c.Peso ?? "").toString().trim(),
        altura: (c.Altura ?? "").toString().trim(),
        procedencia: (c.Procedencia ?? "").toString().trim(),
        destino: (c.Destino ?? "").toString().trim(),
        trayectoria: (c.Trayectoria ?? "").toString().trim(),
        biograf√≠a: (c.Biograf√≠a ?? "").toString().trim(),
        foto1: (c.Foto1 ?? "").toString().trim(),
        foto2: (c.Foto2 ?? "").toString().trim()
      }));

     const partidos1 = Papa.parse(csvPartidos1, { header:true, skipEmptyLines:true }).data;
const partidos2 = Papa.parse(csvPartidos2, { header:true, skipEmptyLines:true }).data;

encuentros = [...partidos1, ...partidos2].map(p => ({
        Fecha: (p.Fecha ?? "").trim(),
        T√©cnico: (p.T√©cnico ?? "").trim(),
        Condici√≥n: (p.Condici√≥n ?? "").trim(),
        Situaci√≥n: (p.Situaci√≥n ?? "").trim(),
        Resultado1: (p.Resultado1 ?? "").trim(),
        Resultado2: (p.Resultado2 ?? "").trim(),
        Club: (p.Club ?? "").trim(),
        Torneo: (p.Torneo ?? "").trim(),
        Estadio: (p.Estadio ?? "").trim(),
        √Årbitro: (p.√Årbitro ?? "").trim(),
        Hurac√°n: (p.Hurac√°n ?? "").trim(),
        Rival: (p.Rival ?? "").trim(),
        Foto: (p.Foto ?? "").trim(),
        Incidencias: (p.Incidencias ?? "").trim()
      }));

      llenarSelectFutbolistas();
    });

    function llenarSelectFutbolistas() {
      const sel = document.getElementById("futbolistaSelect");
      sel.innerHTML = "<option value=''>-- Seleccionar --</option>";
      futbolistas.forEach(a => {
        if (a.futbolista) {
          const opt = document.createElement("option");
          opt.value = a.futbolista;
          opt.textContent = InvertirNombre(a.futbolista);
          sel.appendChild(opt);
        }
      });
      sel.addEventListener("change", mostrarFutbolistas);
    }

function mostrarFutbolistas() {
  const futbolistaId = document.getElementById("futbolistaSelect").value;
  const futbolista = futbolistas.find(a => a.futbolista === futbolistaId);
  if (!futbolista) {
    document.getElementById("futbolistaInfo").style.display = "none";
    return;
  }

      const cont = document.getElementById("futbolistaInfo");
      cont.style.display = "block";
      cont.innerHTML = `
        <div class="club-header">
${futbolista.foto1 ? 
  `<img src="${futbolista.foto1}" 
        alt="${futbolista.futbolista}" 
        style="width:105px;height:140px;object-fit:cover;border-radius:8px;" 
        onerror="this.style.display='none'">` 
  : ""}
      <div style="text-align:center;">
  <h2>${futbolista.futbolista}</h2>
  <div style="font-size:14px; color:black; font-family:Arial, sans-serif;">
    ${getResumenCarrera(futbolista.futbolista)}
  </div>
  ${futbolista.pais
  ? futbolista.pais
      .split(/[\(\),.;\/]|(?:\)\s*)|(?:\s*\()|(?:\s*\d+\s*)/)
      .map(p => p.trim())
      .filter(p => p.length > 0)
      .map(p => `<img src="https://globopedia.github.io/Artids/Banderas/${encodeURIComponent(p)}.png" alt="${p}" title="${p}" class="bandera">`)
      .join("")
  : ""}
  <div class="trayectoria-escudos">
    ${renderTrayectoriaEscudos(futbolista.trayectoria)}
  </div>
  </div>
  </div>
    <p><b>Nombre:</b> ${futbolista.nombre}</p>
    <p><b>Posici√≥n:</b> ${futbolista.posicion}</p>
    <p><b>Procedencia:</b> ${futbolista.procedencia}</p>
    <p><b>Nacimiento:</b> ${futbolista.fechanac}, en ${futbolista.lugarnac}</p>
    <p><b>Muerte:</b> ${futbolista.fechamuerte}, en ${futbolista.lugarmuerte}</p>
    <p><b>Peso:</b> ${futbolista.peso} kg ‚Äî <b>Altura:</b> ${futbolista.altura} m</p>
    <p><b>Destino:</b> ${futbolista.destino}</p>
    <p><b>Biograf√≠a:</b> ${futbolista.biograf√≠a}</p>
    <div style="text-align:center;">
    ${futbolista.foto2 ? 
  `<img src="${futbolista.foto2}" 
        alt="${futbolista.futbolista}" 
        style="width:280px;height:360px;object-fit:cover;border-radius:8px;" 
        onerror="this.style.display='none'">` 
  : ""}
</div>
<div class="stats">
  <h3 style="color:#FF0000;">üìä TRAYECTORIA EN HURAC√ÅN</h3>
  ${renderEstadisticas(futbolista.futbolista)}
</div>
      `;
  }
function limpiarNombreJugador(s) {
  if (!s) return "";
  return String(s)
    .replace(/\u00A0/g, " ")               // NBSP ‚Üí espacio
    .replace(/^\s*\(?\d+\)?\s*/, "")       // quita "(48 " o "48)"
    .replace(/[.,;:)\s]+$/, "")            // quita .,;:) al final
    .replace(/^[\s(]+/, "")                // quita espacios o par√©ntesis al inicio
    .trim();
}
    
function obtenerMinutoIngreso(texto, futbolista) {
  const regex = new RegExp(`\\((\\d+(?:\\+\\d+)?)\\s*${futbolista}`, "i");
  const match = texto.match(regex);
  if (!match) return null;

  const m = match[1];
  return m.includes("+")
    ? m.split("+").map(Number).reduce((a,b)=>a+b)
    : Number(m);
}
function obtenerMinutoSalida(texto, futbolista) {
  const regex = new RegExp(
    `${futbolista}\\s*\\(\\s*(\\d+(?:\\+\\d+)?)\\s+[^()]+`,
    "i"
  );

  const match = texto.match(regex);
  if (!match) return null;

  const m = match[1];
  return m.includes("+")
    ? m.split("+").map(Number).reduce((a,b)=>a+b)
    : Number(m);
}
function renderEstadisticas(nombreFutbolista) {
  const delFutbolista = encuentros.filter(p => {
 const jugadores = (p.Hurac√°n || "")
  // 1Ô∏è‚É£ convertir par√©ntesis en comas (sin regex anidada)
  .replace(/[()]/g, ",")

  // 2Ô∏è‚É£ eliminar minutos: 45, 45+1, 90+3, etc.
  .replace(/\b\d+(?:\+\d+)?\s*/g, "")

  // 3Ô∏è‚É£ normalizaci√≥n
  .replace(/\.+/g, "")
  .replace(/\s+y\s+/gi, ",")
  .replace(/\s+e\s+/gi, ",")
  .replace(/,,+/g, ",")
  .replace(/\s+,/g, ",")
  .replace(/,\s+/g, ",")
  .replace(/\s+/g, " ")

  // 4Ô∏è‚É£ separar jugadores
  .split(/[,;]+/)
  .map(j => j.trim())
  .filter(j => j.length > 1);
    return jugadores.some(j => norm(j) === norm(nombreFutbolista));
  });

  const agg = {};
  for (const e of delFutbolista) {
    const comp = bucketCompetencia(e.Torneo);
    const sit = cap(norm(e.Situaci√≥n));
    if (!agg[comp]) agg[comp] = { Victoria:0, Empate:0, Derrota:0, Goles:0 };
    if (SITUACIONES.includes(sit)) {
      agg[comp][sit] += 1;
    }

    // ‚úÖ contar TODAS las menciones de ‚ÄúGOL jugador (HUR)‚Äù
    const textoIncidencias = norm(e.Incidencias || "");
    const patron = new RegExp(`gol\\s+${norm(nombreFutbolista)}\\s*\\(hur\\)`, "g");
    const golesEnEstePartido = (textoIncidencias.match(patron) || []).length;
    agg[comp].Goles += golesEnEstePartido;
  }

  let html = "";
  for (const comp of ORDEN_COMPETENCIAS) {
    if (!agg[comp]) continue;
    const bucket = agg[comp];
    const total = bucket.Victoria + bucket.Empate + bucket.Derrota;
    if (total === 0) continue;

    const resumen = `G${bucket.Victoria}-E${bucket.Empate}-P${bucket.Derrota}`;
    const goles = bucket.Goles || 0;

    html += `
      <div class="stat-group">
        <div class="stat-title">üèÜ ${comp}</div>
        <ul>
          <li>
            <label>
              <input type="checkbox" class="chkPartidos"
                data-comp="${comp}"
                data-sit="todos"
                data-futbolista="${nombreFutbolista}">
              üìä ${total} ${total === 1 ? "partido" : "partidos"} (${resumen}) ‚Äì ‚öΩ ${goles} ${goles === 1 ? "gol" : "goles"}
            </label>
            <div class="partidos-lista" style="display:none; margin-left:20px;"></div>
          </li>
        </ul>
      </div>
    `;
  }
  return html || "<p>Sin datos disponibles</p>";
}
  // Manejador de checkboxes (muestra partidos por filtro)
document.addEventListener("change", function(e) {
  if (!e.target.classList.contains("chkPartidos")) return;
  const contenedor = e.target.closest("li").querySelector(".partidos-lista");
  contenedor.innerHTML = "";
  if (e.target.checked) {
    const { comp, sit, futbolista } = e.target.dataset;

    // filtrar partidos del futbolista
    const partidos = encuentros.filter(p => {
      // el jugador aparece en la celda de Hurac√°n
const jugadores = (p.Hurac√°n || "")
  // 1Ô∏è‚É£ convertir par√©ntesis en comas (sin regex anidada)
  .replace(/[()]/g, ",")

  // 2Ô∏è‚É£ eliminar minutos: 45, 45+1, 90+3, etc.
  .replace(/\b\d+(?:\+\d+)?\s*/g, "")

  // 3Ô∏è‚É£ normalizaci√≥n
  .replace(/\.+/g, "")
  .replace(/\s+y\s+/gi, ",")
  .replace(/\s+e\s+/gi, ",")
  .replace(/,,+/g, ",")
  .replace(/\s+,/g, ",")
  .replace(/,\s+/g, ",")
  .replace(/\s+/g, " ")

  // 4Ô∏è‚É£ separar jugadores
  .split(/[,;]+/)
  .map(j => j.trim())
  .filter(j => j.length > 1);
      return jugadores.some(j => norm(j) === norm(futbolista)) &&
             bucketCompetencia(p.Torneo) === comp &&
          (sit === "todos" || cap(norm(p.Situaci√≥n)) === sit);
    });

    if (partidos.length) {
      partidos.forEach(p => {
        let bloqueHTML = "";

        if ((p.Condici√≥n || "").toLowerCase() === "visitante") {
          bloqueHTML = `
            <div class="partido-card">
              ${getTorneoImage(p.Torneo)}
              <div><b>${p.Fecha}</b></div>
              <img class="escudo-rival" src="${getEscudo(p.Club)}" alt="${p.Club}" />
              <div class="resultado2-box">${p.Resultado2}</div>
              <div class="resultado1-box">${p.Resultado1}</div>
              <img class="escudo-huracan" src="${getEscudo('Hurac√°n')}" alt="Hurac√°n">
              <div><b>${p.Torneo}</b></div>
              <div><b>Estadio:</b> ${p.Estadio} - <b>√Årbitro:</b> ${p.√Årbitro}</div>
              <div>${ p.Estadio && getEstadioImage(p.Estadio) ? `<img src="${getEstadioImage(p.Estadio)}" style="max-height:40px;">` : "" }</div>
              <div><b>${p.Club}:</b> ${p.Rival}</div>
              <div><b>Hurac√°n:</b> ${p.Hurac√°n}</div>
              ${ p.Foto ? `<div style="margin:6px 0;"><img src="${p.Foto}" style="max-width:250px;border-radius:8px;"></div>` : "" }
              <div>${renderIncidencias(p.Incidencias)}</div>
            </div>
          `;
        } else {
          bloqueHTML = `
            <div class="partido-card">
              ${getTorneoImage(p.Torneo)}
              <div><b>${p.Fecha}</b></div>
              <img class="escudo-huracan" src="${getEscudo('Hurac√°n')}" alt="Hurac√°n">
              <div class="resultado1-box">${p.Resultado1}</div>
              <div class="resultado2-box">${p.Resultado2}</div>
              <img class="escudo-rival" src="${getEscudo(p.Club)}" alt="${p.Club}" />
              <div><b>${p.Torneo}</b></div>
              <div><b>Estadio:</b> ${p.Estadio} - <b>√Årbitro:</b> ${p.√Årbitro}</div>
              <div>${ p.Estadio && getEstadioImage(p.Estadio) ? `<img src="${getEstadioImage(p.Estadio)}" style="max-height:40px;">` : "" }</div>
              <div><b>Hurac√°n:</b> ${p.Hurac√°n}</div>
              <div><b>${p.Club}:</b> ${p.Rival}</div>
              ${ p.Foto ? `<div style="margin:6px 0;"><img src="${p.Foto}" style="max-width:250px;border-radius:8px;"></div>` : "" }
              <div>${renderIncidencias(p.Incidencias)}</div>
            </div>
          `;
        }

// --- TITULAR / SUPLENTE + MINUTOS (DEFINITIVO) ---

const texto = p.Hurac√°n || "";
const jugador = futbolista; // ‚Üê el nombre que ya us√°s en el index
let condicion = "Titular";

let minutosJugados = p.Fin2T || 90;

// normalizar fin del partido
if (typeof minutosJugados === "string" && minutosJugados.includes("+")) {
  const [a, b] = minutosJugados.split("+").map(Number);
  minutosJugados = a + b;
}
minutosJugados = Number(minutosJugados) || 90;

// patr√≥n: "Jugador (73 Otro)"
const saleRegex = new RegExp(`${jugador}\\s*\\((\\d+(?:\\+\\d+)?)`, "i");

// patr√≥n: "(73 Jugador)"
const entraRegex = new RegExp(`\\((\\d+(?:\\+\\d+)?)\\s*${jugador}`, "i");

const ingreso = obtenerMinutoIngreso(texto, futbolista);
const salida  = obtenerMinutoSalida(texto, futbolista);

if (ingreso !== null) {
  // üëâ siempre suplente si tiene minuto de ingreso
  condicion = "Suplente";

  let finReal = p.Fin2T ? Number(p.Fin2T) : 90;

  if (salida !== null) {
    finReal = salida - 1;
  }

  minutosJugados = Math.max(0, finReal - ingreso + 1);

} else if (salida !== null) {
  // üëâ titular que fue reemplazado
  condicion = "Titular";
  minutosJugados = Math.max(0, salida - 1);
}

// --- EXPULSIONES ---
const incidencias = p.Incidencias || "";

// ejemplo: "73 EXP Joaqu√≠n Larrivey"
const expulsionRegex = new RegExp(
  `(\\d+(?:\\+\\d+)?)\\s+EXP\\s+${futbolista}`,
  "i"
);

if (expulsionRegex.test(incidencias)) {
  const m = incidencias.match(expulsionRegex)[1];

  let minutoExpulsion = m.includes("+")
    ? m.split("+").map(Number).reduce((a, b) => a + b)
    : Number(m);

  if (condicion === "Titular") {
    // jug√≥ hasta el minuto anterior a la expulsi√≥n
    minutosJugados = Math.max(0, minutoExpulsion - 1);
  } else {
    // suplente expulsado
    // ingreso = fin del partido - minutos jugados + 1
    const fin = p.Fin2T ? Number(p.Fin2T) : 90;
    const minutoIngreso = fin - minutosJugados + 1;
    minutosJugados = Math.max(0, minutoExpulsion - minutoIngreso + 1);
  }
}
       contenedor.innerHTML += `
          <div class="acordeon">
          <div class="acordeon-header">
 ${condicion} (${minutosJugados}‚Äô) ¬∑
 ${p.Resultado1}-${p.Resultado2}
  <img src="${getEscudo(p.Club)}" alt="${p.Club}" title="${p.Club}"
       style="height:22px; vertical-align:middle; margin:0 6px;">
  [${p.T√©cnico}]
</div>
            <div class="acordeon-body cerrado">${bloqueHTML}</div>
          </div>
        `;
      });
    } else {
      contenedor.innerHTML = "<i>No hay partidos registrados</i>";
    }
    contenedor.style.display = "block";
  } else {
    contenedor.style.display = "none";
  }
});

    document.addEventListener("click", function(e) {
      if (e.target.classList.contains("acordeon-header")) {
        const body = e.target.nextElementSibling;
        body.classList.toggle("cerrado");
        e.target.classList.toggle("abierto");
      }
    });

function getResumenCarrera(nombreFutbolista) {
  const delFutbolista = encuentros.filter(p => {
  const jugadores = (p.Hurac√°n || "")
  // 1Ô∏è‚É£ convertir par√©ntesis en comas (sin regex anidada)
  .replace(/[()]/g, ",")

  // 2Ô∏è‚É£ eliminar minutos: 45, 45+1, 90+3, etc.
  .replace(/\b\d+(?:\+\d+)?\s*/g, "")

  // 3Ô∏è‚É£ normalizaci√≥n
  .replace(/\.+/g, "")
  .replace(/\s+y\s+/gi, ",")
  .replace(/\s+e\s+/gi, ",")
  .replace(/,,+/g, ",")
  .replace(/\s+,/g, ",")
  .replace(/,\s+/g, ",")
  .replace(/\s+/g, " ")

  // 4Ô∏è‚É£ separar jugadores
  .split(/[,;]+/)
  .map(j => j.trim())
  .filter(j => j.length > 1);
    return jugadores.some(j => norm(j) === norm(nombreFutbolista));
  });

  if (!delFutbolista.length) return "";

  // ‚úÖ Total de partidos
  const total = delFutbolista.length;

  // ‚úÖ Contar TODAS las menciones de ‚ÄúGOL jugador (HUR)‚Äù en todo el CSV
  const totalGoles = encuentros.reduce((acc, p) => {
    const texto = norm(p.Incidencias || "");
    const patron = new RegExp(`gol\\s+${norm(nombreFutbolista)}\\s*\\(hur\\)`, "g");
    const coincidencias = texto.match(patron);
    return acc + (coincidencias ? coincidencias.length : 0);
  }, 0);

  // ‚úÖ Fechas para obtener el primer y √∫ltimo a√±o
  const fechasOrdenadas = delFutbolista
    .map(p => p.Fecha)
    .map(f => {
      const [d, m, a] = f.split("/");
      return new Date(`${a}-${m}-${d}`);
    })
    .sort((a, b) => a - b);

  const primerAnio = fechasOrdenadas[0].getFullYear();
  const ultimoAnio = fechasOrdenadas[fechasOrdenadas.length - 1].getFullYear();

  return `${total} ${total === 1 ? "partido" : "partidos"} ‚Äì ${totalGoles} ${totalGoles === 1 ? "gol" : "goles"} (${primerAnio}-${ultimoAnio})`;
}
    function getEscudo(nombreClub) {
  if (!nombreClub) return "";
  const club = nombreClub.trim();
      return `https://globopedia.github.io/Artids/escudos/${encodeURIComponent(club)}.png`;
}
    function renderIncidencias(texto) {
      if (!texto) return "";
      return texto
        .replace(/GOL/g, "<img src='https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgi3GyVjBR-e_IN4mWVAuZofChVOj763GApXwzanoEJDUTysF1K9gf3N5qBCoDJ-ahi8wRkrZ3FCbl0ovTEjXyjFjFEWYF1MZ7YvHrq0bD5eQ7GsJPOkpLSC-k4zpZ1CbnyKVtoYlb6JWXByKkd0VAHuN1hy8P9LBz2fhn5e3Um_X-m4U9WLo9pQP428Fj4/s320/GolR.png' style='width:20px;height:20px;'>")
        .replace(/EXP/g, "<img src='https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgx8a6PCkGhKR9WTnh2NNWLMBDOIKWsNisSChpxN2NayjM5Z6YBIZmv52PvduZawIBBh_g5Pq56LdvjG8X1gSCud2q6NYS_NGOh7nAPaxUy_nC1YCcZJOgy2DeTZPRkqRgb1_HbpJshh-7o3MoW8Z3h8tBa8UZ153n5CzriOyvsSIxM6FsCbn-n115KC5Ln/s320/Roja.png' style='width:20px;height:20px;'>")
        .replace(/ATA/g, "<img src='https://blogger.googleusercontent.com/img/a/AVvXsEjygOwijhQ1dRIh6BPFrQu7EKOUShS0RLEVmPhCJSANGWOaNzvVmcbV03ZW0ZF5Npefl5r3P8iU6WjXRaSL80QYazspsJ4-nzA8pv4FqBwgu1Jr0wDw2iEPMvnVgK0nvRLeZmGYuVW8epSVTyyND28aoQRd9wD9yxKJWBuPOhOoVz-cUgpbM702W2ZlpsF7=w95-h79' style='width:20px;height:20px;'>")
        .replace(/PEN/g, "<img src='https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEho-erXGKkNZ7MaZWOtZw-ru0AnJwAlzHqnl5fKLmUAn_QtAMAbXgGMsqh21htJ2XSePyqAMAq4Xce1RkwkrqrA4Hw312mYcXhXMVW-m64vRS_lKTNgnBNvCzPZsPV3eEk_QclWiNZ9n9pvAQSiscTyp94vbN_h6aMeQ_nwTdBSdXGn5B3HW3A-sj_4Bw1j/s320/Penales.png' style='width:20px;height:20px;'>");
    }

    function getEstadioImage(estadio) {
      if (!estadio) return "";
      const fileName = estadio.normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/\./g, "").replace(/\s+/g, "") + ".png";
      return "https://globopedia.github.io/Artids/Estadios/" + fileName;
    }

    function getTorneoImage(nombreTorneo) {
      if (!nombreTorneo) return "";
      const texto = nombreTorneo.toLowerCase();
      const torneosDisponibles = [
        "Apertura Nacional B 2006","Clausura Nacional B 2007","2¬∞ Puesto Nacional B 2007","Promoci√≥n 2007",
        "Apertura 2007","Clausura 2008","Apertura 2008","Clausura 2009",
        "Apertura 2009","Clausura 2010","Apertura 2010","Clausura 2011",
        "Nacional B 11-12", "Copa Argentina 2012","Copa Argentina 2013","Copa Argentina 2014",
        "Copa Argentina 2015","Copa Argentina 2016","Copa Argentina 2017","Copa Argentina 2018",
        "Copa Argentina 2019","Copa Argentina 2020","Copa Argentina 2022","Copa Argentina 2023",
        "Copa Argentina 2024","Copa Argentina 2025", "Nacional B 12-13", "Nacional B 13-14",
        "Nacional B 2014", "Supercopa 2015", "Campeonato 2015", "Libertadores 2015",
        "Sudamericana 2015", "Campeonato 2016", "Libertadores 2016", "Campeonato 16-17",
        "Sudamericana 2017", "SAF 17-18", "SAF 18-19", "SAF 19-20", "Copa Maradona 2020",
        "Libertadores 2019", "Sudamericana 2020", "Torneo-LPF 2021", "Torneo-LPF 2022", "Torneo-LPF 2023",
        "Copa-LPF 2021", "Copa-LPF 2022", "Copa-LPF 2023", "Copa-LPF 2024", "Torneo-LPF 2024",
        "Apertura-LPF 2025", "Clausura-LPF 2025", "Libertadores 2023", "Sudamericana 2023", "Sudamericana 2025"
      ];
      for (const t of torneosDisponibles) {
        if (texto.includes(t.toLowerCase())) {
          return `<img src="https://globopedia.github.io/Artids/Torneos/${encodeURIComponent(t)}.png" style="max-height:40px; display:block; margin:4px auto;">`;
        }
      }
      return "";
    }

function renderTrayectoriaEscudos(trayectoria) {
  if (!trayectoria) return "";

  const clubes = trayectoria.split(",").map(c => c.trim()).filter(Boolean);

  return clubes.map(club => `
    <img 
      src="${getEscudo(club)}" 
      alt="${club}" 
      title="${club}" 
      style="height:30px; margin:5px;" 
      onerror="this.style.display='none'">
  `).join("");
}
  function InvertirNombre(nombre) {
  const partes = nombre.trim().split(" ");
  if (partes.length < 2) return nombre;

  if (partes.length === 2) {
    // Caso simple: Nombre + Apellido
    const [nombre1, apellido] = partes;
    return apellido + ", " + nombre1;
  }

  // Lista de conectores/apellidos compuestos en min√∫scula
  const conectores = ["de", "del", "de la", "de los", "la", "las", "los", "san", "santa"];

  // Unir las √∫ltimas palabras y ver si forman parte de un apellido compuesto
  let i = partes.length - 1;
  let apellido = partes[i];
  while (i > 0) {
    const posible = partes[i - 1].toLowerCase();
    if (conectores.includes(posible)) {
      apellido = partes[i - 1] + " " + apellido;
      i--;
    } else {
      break;
    }
  }

  const nombres = partes.slice(0, i).join(" ");
  return apellido + ", " + nombres;
}
// --- AUTOCOMPLETADO CON DEBOUNCE --- //
const searchInput = document.getElementById("futbolistaSearch");
const suggestionsList = document.getElementById("autocompleteList");
let debounceTimer;

function debounce(func, delay) {
  return function(...args) {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(() => func.apply(this, args), delay);
  };
}

function filtrarFutbolistas(termino) {
  const termNorm = norm(termino);
  if (!termNorm) {
    suggestionsList.innerHTML = "";
    return;
  }

  const resultados = futbolistas
    .filter(a => norm(a.futbolista).includes(termNorm))
    .slice(0, 15); // limitar cantidad de sugerencias

  suggestionsList.innerHTML = resultados.map(r => `
    <li style="padding:6px;cursor:pointer;border-bottom:1px solid #eee;" 
        onclick="seleccionarFutbolista('${r.futbolista.replace(/'/g, "\\'")}')">
      ${r.futbolista}
    </li>
  `).join("");
}

searchInput.addEventListener("input", debounce(e => filtrarFutbolistas(e.target.value), 200));

function seleccionarFutbolista(nombre) {
  searchInput.value = InvertirNombre(nombre);
  suggestionsList.innerHTML = "";
  const hiddenSelect = document.getElementById("futbolistaSelect");
  hiddenSelect.innerHTML = `<option value="${nombre}" selected></option>`;
  hiddenSelect.value = nombre;
  mostrarFutbolistas();
}
  // --- Navegaci√≥n con teclado en el autocompletado --- //
let selectedIndex = -1;

searchInput.addEventListener("keydown", function(e) {
  const items = suggestionsList.querySelectorAll("li");
  if (!items.length) return;

  if (e.key === "ArrowDown") {
    e.preventDefault();
    selectedIndex = (selectedIndex + 1) % items.length;
    actualizarSeleccion(items);
  } else if (e.key === "ArrowUp") {
    e.preventDefault();
    selectedIndex = (selectedIndex - 1 + items.length) % items.length;
    actualizarSeleccion(items);
  } else if (e.key === "Enter") {
    e.preventDefault();
    if (selectedIndex >= 0 && selectedIndex < items.length) {
      items[selectedIndex].click();
    }
  } else {
    selectedIndex = -1; // reset si escribe algo nuevo
  }
});

function actualizarSeleccion(items) {
  items.forEach((item, i) => {
    const activo = i === selectedIndex;
    item.style.background = activo ? "#ffdddd" : "white";
    if (activo) {
      // üëâ Mostrar texto completo en el input (typeahead visual)
      const texto = item.textContent.trim();
      searchInput.value = texto;
    }
  });

  // desplazamiento autom√°tico si el √≠tem est√° fuera de vista
  const selectedItem = items[selectedIndex];
  if (selectedItem) {
    const containerTop = suggestionsList.scrollTop;
    const containerBottom = containerTop + suggestionsList.offsetHeight;
    const itemTop = selectedItem.offsetTop;
    const itemBottom = itemTop + selectedItem.offsetHeight;
    if (itemTop < containerTop) {
      suggestionsList.scrollTop = itemTop;
    } else if (itemBottom > containerBottom) {
      suggestionsList.scrollTop = itemBottom - suggestionsList.offsetHeight;
    }
  }
}
// --- Cerrar autocompletado con ESC --- //
searchInput.addEventListener("keydown", function(e) {
  if (e.key === "Escape") {
    suggestionsList.innerHTML = "";
    selectedIndex = -1;
    searchInput.blur(); // opcional: quita el foco del input
  }
});
// --- Cerrar autocompletado al hacer clic fuera --- //
document.addEventListener("click", function(e) {
  const esClickEnInput = searchInput.contains(e.target);
  const esClickEnLista = suggestionsList.contains(e.target);
  if (!esClickEnInput && !esClickEnLista) {
    suggestionsList.innerHTML = "";
    selectedIndex = -1;
  }
});
// --- Reabrir sugerencias si el input tiene texto y se hace clic --- //
searchInput.addEventListener("focus", function(e) {
  const texto = searchInput.value.trim();
  if (texto.length > 0 && suggestionsList.innerHTML === "") {
    filtrarFutbolistas(texto);
  }

  // ü™Ñ Truco: seleccionar todo el texto despu√©s de un clic o foco
  setTimeout(() => {
    if (document.activeElement === searchInput) {
      searchInput.select();
    }
  }, 150);
});
</script>
</body>
</html>
